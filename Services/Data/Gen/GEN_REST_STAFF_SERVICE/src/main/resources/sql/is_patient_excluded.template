SELECT DISTINCT T1.PATIENT_ID,T1.BSN_ENT_ID,T1.SCHED_PTC_EXCL_TYPE
  FROM SCHED_PTC_EXCL T1
LEFT JOIN (SELECT PATIENT_ID,BSN_ENT_ID,REC_TERM_TMSTP,CURR_REC_IND
  FROM PATIENT) T2
ON T1.PATIENT_ID = T2.PATIENT_ID AND T1.BSN_ENT_ID = T2.BSN_ENT_ID
WHERE T2.PATIENT_ID = ? AND T1.STAFF_ID = ? AND T1.BSN_ENT_ID = ? AND UPPER(SCHED_PTC_EXCL_TYPE) = 'EXCLUDE_PATIENT' AND
       (TO_CHAR(T1.REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND T1.CURR_REC_IND = '1') AND
       (TO_CHAR(T2.REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND T2.CURR_REC_IND = '1')
