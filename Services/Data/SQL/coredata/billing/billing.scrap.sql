SELECT TO_DATE(TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS') AS SUBMISSION_DATE FROM DUAL;

SELECT TO_DATE(TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS') AS SUBMISSION_DATE, T1.*
FROM INV T1;

-- Billing Preview Summary

-- Overview
SELECT TO_DATE(TO_CHAR(CURRENT_TIMESTAMP, 'YYYY-MM-DD HH24:MI:SS'), 'YYYY-MM-DD HH24:MI:SS') AS SUBMISSION_DATE,
        Count(*) AS TOTAL_INVOICES_BILLED,
        ROUND(SUM(INV_TOTAL_AMT),2) AS TOTAL_AMOUNT_BILLED,
        ROUND(SUM(INV_TOTAL_UNIT/3600),0) AS BILLED_HOURS
FROM INV
WHERE INV_SK IN (1,5)
        AND INV_TOTAL_AMT IS NOT NULL
        AND INV_TOTAL_UNIT IS NOT NULL;

-- BY LOB
SELECT BE_LOB_ID AS LINE_OF_BUSINESS,
          Count(*) AS TOTAL_INVOICES_BILLED,
          ROUND(SUM(INV_TOTAL_AMT),2) AS TOTAL_AMOUNT_BILLED,
          ROUND(SUM(INV_TOTAL_UNIT/3600),0) AS BILLED_HOURS
FROM INV
WHERE INV_SK IN (1,5)
        AND INV_TOTAL_AMT IS NOT NULL
        AND INV_TOTAL_UNIT IS NOT NULL
GROUP BY BE_LOB_ID;

-- BY PAYER
SELECT PAYER_NAME AS PAYER,
          Count(*) AS TOTAL_INVOICES_BILLED,
          ROUND(SUM(INV_TOTAL_AMT),2) AS TOTAL_AMOUNT_BILLED,
          ROUND(SUM(INV_TOTAL_UNIT/3600),0) AS BILLED_HOURS
FROM INV T1
INNER JOIN (SELECT BE_ID,PAYER_ID,PAYER_NAME
  FROM PAYER) T2
ON T1.BE_ID = T2.BE_ID AND T1.PAYER_ID = T2.PAYER_ID
WHERE T1.INV_SK IN (1,5)
        AND INV_TOTAL_AMT IS NOT NULL
        AND INV_TOTAL_UNIT IS NOT NULL
GROUP BY PAYER_NAME;

-- BY SUBMISSION TYPE
SELECT INV_SUBM_TYP_NAME AS SUBMISSION_TYPE,
          Count(*) AS TOTAL_INVOICES_BILLED,
          ROUND(SUM(INV_TOTAL_AMT),2) AS TOTAL_AMOUNT_BILLED,
          ROUND(SUM(INV_TOTAL_UNIT/3600),0) AS BILLED_HOURS
FROM INV
WHERE INV_SK IN (1,5)
        AND INV_TOTAL_AMT IS NOT NULL
        AND INV_TOTAL_UNIT IS NOT NULL
GROUP BY INV_SUBM_TYP_NAME;

-- Billable Review Invoice Details
SELECT T1.BE_LOC_ID,T1.INV_SK,T1.BE_LOB_ID,T3.PAYER_NAME,T4.CONTR_DESC,T1.INV_START_DATE,T1.INV_END_DATE,
          T1.INV_NUM,T1.INV_DATE,T5.PT_FIRST_NAME,T5.PT_LAST_NAME,T1.PT_INS_ID_NUM,T6.BE_NAME,
          T1.INV_TOTAL_AMT,T1.INV_SUBM_TYP_NAME
        FROM INV T1

  -- Payer Name
  LEFT JOIN (SELECT BE_ID,PAYER_ID,PAYER_NAME
    FROM PAYER
      WHERE (TO_CHAR(REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND CURR_REC_IND = 1)) T3
    ON T1.BE_ID = T3.BE_ID AND T1.PAYER_ID = T3.PAYER_ID

  -- Contract Description
  LEFT JOIN (SELECT BE_ID,PAYER_ID,CONTR_ID,CONTR_DESC
    FROM CONTR
      WHERE (TO_CHAR(REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND CURR_REC_IND = 1)) T4
    ON T1.BE_ID = T4.BE_ID AND T1.PAYER_ID = T4.PAYER_ID AND T1.CONTR_ID = T4.CONTR_ID

  -- Patient First/Last Name
   LEFT JOIN (SELECT BE_ID,PT_ID,PT_FIRST_NAME,PT_LAST_NAME
    FROM PT
      WHERE (TO_CHAR(REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND CURR_REC_IND = 1)) T5
    ON T1.BE_ID = T5.BE_ID AND T1.PT_ID = T5.PT_ID

  -- Location
  LEFT JOIN (SELECT BE_ID,BE_NAME
    FROM BE
      WHERE (TO_CHAR(REC_TERM_TMSTP, 'YYYY-MM-DD') = '9999-12-31' AND CURR_REC_IND = 1)) T6
    ON T1.BE_LOC_ID = T6.BE_ID

  WHERE T1.INV_SK IN (1,5)

ORDER BY PAYER_NAME;

Commit;